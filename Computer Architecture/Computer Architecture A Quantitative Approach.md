# Computer Architecture A Quantitative Approach

标签（空格分隔）： 计算机体系结构量化研究方法

---

计算机体系结构有关公式
+ CPU时间=指令数×CPI×时钟周期时间
+ X的速度是Y的n倍：n=执行时间（Y）/执行时间（X）=性能(X)/性能(Y)
+ Amdahl定律：总加速比=原执行时间/新执行时间=1/（1-升级比例）+升级比例/升级加速比
+ 能耗（动态）正比于1/2×容性负载×电压²
+ 功率（动态）正比于1/2×容性负载×电压²×开关频率
+ 功率（动态）正比于电流（静态）×电压
+ 模块可用性=平均无故障时间/平均无故障时间+平均修复时间
+ 晶片正品率=晶圆正品率×1/（1+单位面积上的缺陷×晶片面积）的N次方（其中晶圆正品率考虑了坏到不需要测试的晶圆，N是一个称为工艺复杂度因数的参数，是制造难度的度量。2011年，N的变化范围11.5至15.5）
+ 算数均值（AM）加权算术均值（WAM）和几何均值（GM）
+ 存储器平均访问时间=命中时间+缺失率×缺失代价
+ 缺失数/指令=缺失率×（存储器访问/指令）
+ 缓存索引大小：2的索引次方=缓存大小/（块大小×组相联度）
+ 仓库级计算机的功率利用效率（PUE）=（总设施功率）/（IT设备功率）


经验法则

 1. Amadahl/Case法则：平衡的计算机系统需要大约1MB的主存储器容量和1Mbit/s的I/O带宽与每MIPS的CPU性能相对应
 2. 90/10局域性法则：程序在其10%的代码中执行其大约90%的指令
 3. 带宽法则：带宽的增长量至少是延迟改进量的平方
 4. 2：1缓存法则：大小为N的直接映射缓存的缺失率大约与大小为N/2的两路组相联缓存相同
 5. 可靠性法则：没有单点故障的设计
 6. 瓦-年法则：2011年，北美仓库级计算机的全负载成本（包括分摊电力和制冷基础设施的成本）大约为2美元/（瓦年）


为了保持生产效率并尝试缩小性能差距，采用即时just-in-time编译器和跟踪编译trace-based compiling的解释器正在取代过去的传统编译器和链接器。
从2003年开始，由于风冷芯片最大功耗和无法有效地开发更多指令级并行这两大孪生瓶颈，单处理器的性能提高速度下降到每年不足22%。
Intel在2004年取消高性能单核处理器项目，宣布，为了获得更高性能的处理器，应该提高一个芯片上集成的核心数目，而不是加快单核处理器的速度。这标志着，处理器性能的提高从单纯依赖指令级并行（ILP）转向**数据级并行（DLP）**和**线程级并行（TLP）**。
编译器和硬件都是隐式开发ILP的，不会引起程序员的注意，而DLP，TLP和RLP则是显式并行的，需要调整应用程序的结构才能开发显式并行。

SaaS应用的发展已经推动了一类被称为集群的计算机的发展。集群是指一组桌面计算机或服务器通过局域网连接在一起，运转方式类似于一个更大型的计算机。每个节点都运行自己的操作系统，节点之间使用网络协议进行通信。最大规模的集群称为仓库级计算机（WSC）。它们的设计方式使数万个服务器像一个服务器一样运行。
WSC与服务器的区别在于，WSC以很多廉价组件为构建模块，依靠软件层来捕获和隔离在这一级别进行计算时发生的许多故障。注意，**WSC的可扩展性是由连接这些计算机的局域网实现的，而不是像服务器那样，通过集成计算机硬件来实现**

超级计算机强调浮点性能，会运行大型的，通信密集的批程序，这些程序可能会一次运行几个星期。这种紧耦合性决定了超级计算机要使用非常快速的内部网络。而WSC不同，重视互动应用程序，大规模存储，可靠性和很高的因特网带宽。

我们以能否运行第三方软件作为区分嵌入式和非嵌入式计算机的分界线。
**并行度和并行体系结构的分类**
应用程序中主要有以下两种并行

 - 数据级并行（DLP），可以同时操作许多数据项
 - 任务级并行（TLP），创建了一些能够单独处理但大量采用并行方式执行的工作任务
 
计算机硬件又以如下4种主要方式来开发这两种类型的应用并行
 
 - **指令级并行**在编译器的帮助下，利用流水线之类的思想适度开发数据级并行，利用推理执行之类的思想以中等水平开发数据级并行。
 - **向量体系结构和图形处理器（GPU）**将单条指令并行应用于一个数据集，以开发数据级并行。
 - **线程级并行**在一种紧耦合硬件模型中开发数据级并行或任务级并行，这种模型允许在并行线程之间进行交互。
 - **请求级并行**在程序员或操作系统指定的大量去耦合任务之间开发并行。
 
按照多处理器最受约束组件中的指令流及数据流的并行，Michael Flynn将所有计算机分为以下四类:
 - **单指令流，单数据流(SISD)**:单处理器，程序员将其看作标准的顺序计算机，但可以利用指令级并行。
 - **单指令流，多数据流（SIMD）**：同一指令由多个使用不同数据流的处理器执行。SIMD计算机开发**数据级并行**，对多个数据项并行执行相同操作。每个处理器都有自己的数据存储器（MD），但只有一个指令存储器和控制处理器，用来提取和分派指令。
 - **多指令流，单数据流（MISD）**：
 - **多指令流，多数据流（MIMD）**：每个处理器都提取自己的指令，对自己的数据进行操作，它针对的是任务级并行。
 

**指令级体系结构（ISA)**

 1. **ISA分类**：现今所有ISA都划分到通用寄存器体系结构中，在这种体系结构中，操作数或者是寄存器或者是存储器地址。**寄存器-存储器ISA**，比如80x86可以在许多指令中访问存储器。**载入-存储ISA**，比如arm和MIPS，只能用载入或存储指令来访问存储器。所有最新ISA都采用载入-存储版本。
 2. **存储器寻址**：包括80x86,arm,mips都使用字节寻址来访问存储器操作数。
 3. **寻址模式**MIPS寻址模式为：寄存器寻址，立即数寻址和位移量寻址。80x86支持上述三种模式，再加上位移量的三种变化形式，即寄存器间接寻址，基址寻址和变址寻址。arm拥有三种MIPS寻址模式再加上相对PC（程序计数器）的寻址方式，两个寄存器之和。还有自动递增寻址和自动递减寻址。
 4. **操作数的类型和大小**：80x86,ARM&MIPS支持的操作数大小为8位（ASCII字符），16位（Unicode字符或半个字），32位（整数或字），64位（双字或长整型）以及IEEE754浮点数，包括32位（单精度）和64位（双精度）。80x86还支持80位浮点（扩展双精度）。
 5. **操作指令**：常见的操作类别为：数据传输指令，算数逻辑指令，控制指令和浮点指令。
 6. **控制流指令**：几乎所有ISA，都支持条件转移，无条件跳转，过程调用和返回。
 7. **ISA的编码**：有两种基本的编码选择：**固定长度**和**可变长度**。
 

**技术趋势**
计算机的实现包括两个方面：组成和硬件。要为计算机的发展作长远计划，设计人员必须了解实现技术的快速变化。以下五种实现技术是现代计算机实现不可或缺的，它们都在发生急剧的变化。

 - **集成电路逻辑技术**
 - **半导体DRAM（动态随机访问存储器）**
 - **半导体闪存（电可擦编程只读存储器）**
 - **磁盘技术**
 - **网络技术**
 
 - **性能趋势：带宽胜过延迟**
 - 一个简单的经验法则是：带宽的增长速度至少是延迟改进速度的平方。

